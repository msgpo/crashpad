add_library(util OBJECT)
crashpad_set_props(util)

target_compile_definitions(util PRIVATE -DZLIB_CONST)

target_sources(util
  PRIVATE
  file/delimited_file_reader.cc
  file/delimited_file_reader.h
  file/directory_reader.h
  file/file_io.cc
  file/file_io.h
  file/file_reader.cc
  file/file_reader.h
  file/file_seeker.cc
  file/file_seeker.h
  file/file_writer.cc
  file/file_writer.h
  file/filesystem.h
  file/output_stream_file_writer.cc
  file/output_stream_file_writer.h
  file/scoped_remove_file.cc
  file/scoped_remove_file.h
  file/string_file.cc
  file/string_file.h
  misc/address_sanitizer.h
  misc/address_types.h
  misc/arraysize.h
  misc/as_underlying_type.h
  misc/capture_context.h
  misc/clock.h
  misc/elf_note_types.h
  misc/from_pointer_cast.h
  misc/implicit_cast.h
  misc/initialization_state.h
  misc/initialization_state_dcheck.cc
  misc/initialization_state_dcheck.h
  misc/lexing.cc
  misc/lexing.h
  misc/memory_sanitizer.h
  misc/metrics.cc
  misc/metrics.h
  misc/paths.h
  misc/pdb_structures.cc
  misc/pdb_structures.h
  misc/random_string.cc
  misc/random_string.h
  misc/range_set.cc
  misc/range_set.h
  misc/reinterpret_bytes.cc
  misc/reinterpret_bytes.h
  misc/scoped_forbid_return.cc
  misc/scoped_forbid_return.h
  misc/symbolic_constants_common.h
  misc/time.cc
  misc/time.h
  misc/tri_state.h
  misc/uuid.cc
  misc/uuid.h
  misc/zlib.cc
  misc/zlib.h
  net/http_body.cc
  net/http_body.h
  net/http_body_gzip.cc
  net/http_body_gzip.h
  net/http_headers.h
  net/http_multipart_builder.cc
  net/http_multipart_builder.h
  net/http_transport.cc
  net/http_transport.h
  net/url.cc
  net/url.h
  numeric/checked_address_range.cc
  numeric/checked_address_range.h
  numeric/checked_range.h
  numeric/checked_vm_address_range.h
  numeric/in_range_cast.h
  numeric/int128.h
  numeric/safe_assignment.h
  process/process_id.h
  process/process_memory.cc
  process/process_memory.h
  process/process_memory_native.h
  process/process_memory_range.cc
  process/process_memory_range.h
  stdlib/aligned_allocator.cc
  stdlib/aligned_allocator.h
  stdlib/map_insert.h
  stdlib/objc.h
  stdlib/string_number_conversion.cc
  stdlib/string_number_conversion.h
  stdlib/strlcpy.cc
  stdlib/strlcpy.h
  stdlib/strnlen.cc
  stdlib/strnlen.h
  stdlib/thread_safe_vector.h
  stream/base94_output_stream.cc
  stream/base94_output_stream.h
  stream/file_encoder.cc
  stream/file_encoder.h
  stream/file_output_stream.cc
  stream/file_output_stream.h
  stream/log_output_stream.cc
  stream/log_output_stream.h
  stream/output_stream_interface.h
  stream/zlib_output_stream.cc
  stream/zlib_output_stream.h
  string/split_string.cc
  string/split_string.h
  synchronization/semaphore.h
  thread/stoppable.h
  thread/thread.cc
  thread/thread.h
  thread/thread_log_messages.cc
  thread/thread_log_messages.h
  thread/worker_thread.cc
  thread/worker_thread.h
)

if(UNIX)
  target_sources(util
    PRIVATE
    file/directory_reader_posix.cc
    file/file_io_posix.cc
    file/filesystem_posix.cc
    misc/clock_posix.cc
    posix/close_stdio.cc
    posix/close_stdio.h
    posix/scoped_dir.cc
    posix/scoped_dir.h
    posix/scoped_mmap.cc
    posix/scoped_mmap.h
    posix/signals.cc
    posix/signals.h
    synchronization/semaphore_posix.cc
    thread/thread_posix.cc
    posix/close_multiple.cc
    posix/close_multiple.h
    posix/double_fork_and_exec.cc
    posix/double_fork_and_exec.h
    posix/drop_privileges.cc
    posix/drop_privileges.h
    posix/process_info.h
    posix/symbolic_constants_posix.cc
    posix/symbolic_constants_posix.h
  )
endif()

if(UNIX AND NOT APPLE)
  target_sources(util
    PRIVATE
    linux/address_types.h
    linux/auxiliary_vector.cc
    linux/auxiliary_vector.h
    linux/checked_linux_address_range.h
    linux/direct_ptrace_connection.cc
    linux/direct_ptrace_connection.h
    linux/exception_handler_client.cc
    linux/exception_handler_client.h
    linux/exception_handler_protocol.cc
    linux/exception_handler_protocol.h
    linux/exception_information.h
    linux/memory_map.cc
    linux/memory_map.h
    linux/proc_stat_reader.cc
    linux/proc_stat_reader.h
    linux/proc_task_reader.cc
    linux/proc_task_reader.h
    linux/ptrace_broker.cc
    linux/ptrace_broker.h
    linux/ptrace_client.cc
    linux/ptrace_client.h
    linux/ptrace_connection.h
    linux/ptracer.cc
    linux/ptracer.h
    linux/scoped_pr_set_dumpable.cc
    linux/scoped_pr_set_dumpable.h
    linux/scoped_pr_set_ptracer.cc
    linux/scoped_pr_set_ptracer.h
    linux/scoped_ptrace_attach.cc
    linux/scoped_ptrace_attach.h
    linux/socket.cc
    linux/socket.h
    linux/thread_info.cc
    linux/thread_info.h
    linux/traits.h
    misc/capture_context_linux.S
    misc/paths_linux.cc
    misc/time_linux.cc
    net/http_transport_socket.cc
    posix/process_info_linux.cc
    process/process_memory_linux.cc
    process/process_memory_linux.h
    process/process_memory_sanitized.cc
    process/process_memory_sanitized.h
  )
endif()
